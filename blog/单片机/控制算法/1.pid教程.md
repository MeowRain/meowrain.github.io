<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/pidliucheng.png"/></div>

「期望值是什么，与控制器没有关系」，而是与物理对象有关。更直接的原因是因为你使用了这个物理量做反馈而，期望值需要与反馈做差，所以期望值才有了物理意义。「期望值是什么取决于反馈值是什么。」

# 一、PID控制算法原理

PID控制应该算是应用非常广泛的控制算法了。小到控制一个元件的温度，大到控制无人机的飞行姿态和飞行速度等等，都可以使用PID控制。这里我们从原理上来理解PID控制。

PID(proportion integration differentiation)其实就是指比例，积分，微分控制。先把图片和公式摆出来，看不懂没关系。（一开始看这个算法，公式能看懂，具体怎么用怎么写代码也知道，但是就是不知道原理，不知道为什么要用比例，微分，积分这3个项才能实现最好的控制，用其中两个为什么不行，用了3个项能好在哪里，每一个项各有什么作用）

<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/pidsuanfayuanli.jpg"/></div>

<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/v2-62c56b1eb4c053d58894740a8ce250a0_r.jpg"></div>

总的来说，当得到系统的输出后，将输出经过比例，积分，微分3种运算方式，叠加到输入中，从而控制系统的行为，下面用一个简单的实例来说明。

## 1.1 比例控制算法

我们先说PID中最简单的比例控制，抛开其他两个不谈。还是用一个经典的例子吧。假设我有一个水缸，最终的控制目的是要保证水缸里的水位永远的维持在1米的高度。假设初始时刻，水缸里的水位是0.2米，那么当前时刻的水位和目标水位之间是存在一个误差的error，且error为0.8.这个时候，假设旁边站着一个人，这个人通过往缸里加水的方式来控制水位。如果单纯的用比例控制算法，就是指加入的水量u和误差error是成正比的。即

u=kp*error

### 1.1.1 比例控制kp

假设kp取0.5，

那么t=1时（表示第1次加水，也就是第一次对系统施加控制），那么u=0.5*0.8=0.4，所以这一次加入的水量会使水位在0.2的基础上上升0.4，达到0.6.

接着，t=2时刻（第2次施加控制），当前水位是0.6，所以error是0.4。u=0.5*0.4=0.2，会使水位再次上升0.2，达到0.8.

如此这么循环下去，就是比例控制算法的运行方法。

可以看到，最终水位会达到我们需要的1米。

### 1.1.2 稳态误差

但是，单单的比例控制存在着一些不足，其中一点就是 –稳态误差！（我也是看了很多，并且想了好久才想通什么是稳态误差以及为什么有稳态误差）。

像上述的例子，根据kp取值不同，系统最后都会达到1米，只不过kp大了到达的快，kp小了到达的慢一些。不会有稳态误差。但是，考虑另外一种情况，假设这个水缸在加水的过程中，存在漏水的情况，假设每次加水的过程，都会漏掉0.1米高度的水。仍然假设kp取0.5，那么会存在着某种情况，假设经过几次加水，水缸中的水位到0.8时，水位将不会再变换！！！因为，水位为0.8，则误差error=0.2. 所以每次往水缸中加水的量为u=0.5*0.2=0.1.同时，每次加水，缸里又会流出去0.1米的水！！！加入的水和流出的水相抵消，水位将不再变化！！

也就是说，我的目标是1米，但是最后系统达到0.8米的水位就不再变化了，且系统已经达到稳定。由此产生的误差就是稳态误差了。

（在实际情况中，这种类似水缸漏水的情况往往更加常见，比如控制汽车运动，摩擦阻力就相当于是“漏水”，控制机械臂、无人机的飞行，各类阻力和消耗都可以理解为本例中的“漏水”）
所以，单独的比例控制，在很多时候并不能满足要求。

## 1.2 积分控制算法

还是用上面的例子，如果仅仅用比例，可以发现存在暂态误差，最后的水位就卡在0.8了。于是，在控制中，我们再引入一个分量，该分量和误差的积分是正比关系。所以，比例+积分控制算法为：

u=kp*error+ ki∗∫ error

### 1.2.1 积分项ki∗∫ error
还是用上面的例子来说明，第一次的误差error是0.8，第二次的误差是0.4，至此，误差的积分（离散情况下积分其实就是做累加），∫error=0.8+0.4=1.2. 这个时候的控制量，除了比例的那一部分，还有一部分就是一个系数ki乘以这个积分项。由于这个积分项会将前面若干次的误差进行累计，所以可以很好的消除稳态误差（假设在仅有比例项的情况下，系统卡在稳态误差了，即上例中的0.8，由于加入了积分项的存在，会让输入增大，从而使得水缸的水位可以大于0.8，渐渐到达目标的1.0.）这就是积分项的作用。

## 1.3 微分控制算法

换一个另外的例子，考虑刹车情况。平稳的驾驶车辆，当发现前面有红灯时，为了使得行车平稳，基本上提前几十米就放松油门并踩刹车了。当车辆离停车线非常近的时候，则使劲踩刹车，使车辆停下来。整个过程可以看做一个加入微分的控制策略。

### 1.3.1 微分项kp

微分，说白了在离散情况下，就是error的差值，就是t时刻和t-1时刻error的差，即u=kd*（error（t）-error（t-1）），其中的kd是一个系数项。可以看到，在刹车过程中，因为error是越来越小的，所以这个微分控制项一定是负数，在控制中加入一个负数项，他存在的作用就是为了防止汽车由于刹车不及时而闯过了线。从常识上可以理解，越是靠近停车线，越是应该注意踩刹车，不能让车过线，所以这个微分项的作用，就可以理解为刹车，当车离停车线很近并且车速还很快时，这个微分项的绝对值（实际上是一个负数）就会很大，从而表示应该用力踩刹车才能让车停下来。
切换到上面给水缸加水的例子，就是当发现水缸里的水快要接近1的时候，加入微分项，可以防止给水缸里的水加到超过1米的高度，说白了就是减少控制过程中的震荡。


## 1.4 算法回顾

现在在回头看这个公式，就很清楚了

<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/v2-62c56b1eb4c053d58894740a8ce250a0_r.png"></div>

括号内第一项是比例项，第二项是积分项，第三项是微分项，前面仅仅是一个系数。很多情况下，仅仅需要在离散的时候使用，则控制可以化为

<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/v2-4326b375a25935a41bf3c5ed64eb7d65_r.png"></div>


每一项前面都有系数，这些系数都是需要实验中去尝试然后确定的，为了方便起见，将这些系数进行统一一下：

<img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/v2-25965fdad08db6f281dee7e0903229f0_1440w.png"/>

这样看就清晰很多了，且比例，微分，积分每个项前面都有一个系数，且离散化的公式，很适合编程实现。

讲到这里，PID的原理和方法就说完了，剩下的就是实践了。在真正的工程实践中，最难的是如果确定三个项的系数，这就需要大量的实验以及经验来决定了。通过不断的尝试和正确的思考，就能选取合适的系数，实现优良的控制器。

## 1.5 总结

我喜欢这样理解pid: p是控制现在，i是纠正曾经，d是管控未来

推荐阅读： <a href="https://zhuanlan.zhihu.com/p/39573490">PID控制算法原理（抛弃公式，从本质上真正理解PID控制）</a>

# 二、常用PID算法

## ①PI算法：
特点：

* 从时域上看，只要存在偏差，积分就会不停对偏差积累，因此稳态时误差一定为零
* 不足：比例与积分动作都是对过去控制误差进行操作， 不对未来控制误差进行预测，限制了控制性能。
* PI调节将比列调节的快速反应与积分调节消除静差的特点结合，实现好的调节效果。
* PI调节适用于控制通道滞后较小、负荷变化不大、 工艺参数不允许有静差的系统。

## ②PD算法：

适用于舵机快速响应

对于惯性较大的对象，常常希望能加快控制速度， 此时可增加微分作用。

特点：

* 比例控制对于惯性较大对象，控制过程缓慢，控制品质不佳。比例微分控制可提高控制速度，对惯性较大对象，可改善控制质量，减小偏差，缩短控制时间。
* 理想微分作用持续时间太短， 执行器来不及响应。实际使用中，一般加以惯性延迟，称为实际微分。
* PD 调节以比例调节为主，微分调节为辅，PD调节是有差调节。
* PD 调节具有提高系统稳定性、抑制过渡过程最大动态偏差的作用。
* PD 调节有利于提高系统响应速度。
* PD 调节抗干扰能力差，一般只能应用于被调参数 变化平稳的生产过程。
* 微分作用太强时，容易造成系统振荡。

## ③PID算法：

将比例、积分、微分三种调节规律结合在一起， 只要三项作用的强度配合适当，既能快速调节，又能消除余差，可得到满意的控制效果。

特点：

* PID 控制作用中，比例作用是基础控制；微分作用是 用于加快系统控制速度；积分作用是用于消除静差。

* 只要比例、积分、微分三种控制规律强度配合适当， 既能快速调节，又能消除余差，可得到满意控制效果。

* Kp 较小时，系统对微分和积分环节的引入较为敏感，积分会引起超调，微分可能会引起振荡，而振荡剧烈的时候超调也会增加。

* Kp 增大时，积分环节由于滞后产生的超调逐渐减小，此时如果想要继续减少超调可以适当引入微分环节。继续增大 Kp 系统可能会不太稳定，因此在增加 Kp 的同时引入 Kd 减小超调，可以保证在 Kp 不是很大的情况下也能取得较好的稳态特性和动态性能。

* Kp 较小时，积分环节不宜过大，Kp 较大时积分环节也不宜过小（否则调节时间会非常地长），当使用分段PID ，在恰当的条件下分离积分，可以取得更好的控制效果。原因在于在稳态误差即将满足要求时，消除了系统的滞后。因此系统超调会明显减少。

## 增量式PID的优缺点： 

### 位置型PID和增量型PID的比较：
* 位置式需引入初始阀位值，增量式不需要
* 位置式需防积分饱和，增量式不会产生积分饱和
* 只有存在偏差时，增量式才会有输出
* 增量式容易实现从手动到自动的切换
* 位置式PID控制的输出与整个过去的状态有关，用到了误差的累加值;而增量式PID的输出只与当前拍和前两拍的误差有关，因此位置式PID控制的累积误差相对更大;

### 优点：

* ①算式中不需要累加。控制增量Δu(k)的确定仅与最近3次的采样值有关，容易通过加权处理获得比较好的控制效果；
* ②计算机每次只输出控制增量，即对应执行机构位置的变化量，故机器发生故障时影响范围小、不会严重影响生产过程；
* ③手动—自动切换时冲击小。当控制从手动向自动切换时，可以作到无扰动切换。

### 缺点

* ①需要对控制量进行记忆。

* ②存在稳态误差
<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/pidquedian.png"></div>


# 三、PID优化方法

参考<a href="https://blog.csdn.net/name_longming/article/details/115093338">史上最详细的PID教程——理解PID原理及优化算法</a>

## ①抗积分饱和：

如果系统总是存在统一的方向偏差，就可能无限累加而进行饱和，极大影响系统性能

所谓积分饱和就是指系统存在一个方向的偏差，PID控制器的输出由于积分作用的不断累加而扩大，从而导致控制器输出不断增大超出正常范围进入饱和区。当系统出现反响的偏差时，需要首先从饱和区退出，而不能对反向的偏差进行快速的响应。

为了解决积分饱和的问题，人们引入了抗积分饱和的PID算法。所谓抗积分饱和算法，其思路是在计算U(k)的时候，先判断上一时刻的控制量U(k-1)是否已经超出了限制范围。若U(k-1)>Umax，则只累加负偏差；若U(k-1)<Umin，则只累加正偏差。从而避免控制量长时间停留在饱和区。

## 几种方法抗饱和积分

* 积分分离或者称为去积分算法，变速积分（积分项和误差相映射）；

    <a href="https://blog.csdn.net/control_zj/article/details/79811958">增量式PID分步积分与变速积分的融合实现_control_zj的博客-CSDN博客</a>

* 在饱和的时候将积分器的累计值初始化到一个比较理想的值；

* 若积分饱和因为目标值突然变化而产生，将目标值以适当斜率的斜坡变化可避免此情形；

* 将积分累计量限制上下限，避免积分累计量超过限制值；

* 如果PID输出已经饱和，重新计算积分累计量，使输出恰好为合理的范围；

    <a href="https://zhuanlan.zhihu.com/p/49572763">PID的TRICK(一)简述五种PID积分抗饱和（ANTI-Windup）方法 - 知乎 (zhihu.com)</a>

系统对于积分项的要求是，系统偏差大时，积分作用应该减弱甚至是全无，而在偏差小时，则应该加强。积分系数取大了会产生超调，甚至积分饱和，取小了又不能短时间内消除静差。因此，根据系统的偏差大小改变积分速度是有必要的。 变积分PID的基本思想是设法改变积分项的累加速度，使其与偏差大小相对应：偏差越大，积分越慢; 偏差越小，积分越快。

# ②不完全微分：


# 参考

<a href="https://blog.csdn.net/m0_46182401/article/details/129657497">智能车PID控制详细介绍（普通PID、串级PID、改进PID）——适用于四轮车、三轮车、平衡车</a>

<a href="https://blog.csdn.net/as480133937/article/details/89508034">位置式PID与增量式PID区别浅析</a>

<a href="https://blog.csdn.net/m0_73936072/article/details/128264417">关于PID的输入输出是什么--供自己复习使用</a>

