# 一、编码器接口简介
* 编码器接口可接收增量（正交）编码器的信号，根据编码器旋转产生的正交信号脉冲，自动控制CNT自增或自减，从而指示编码器的位置、旋转方向和旋转速度

* 每个高级定时器和通用定时器都拥有一个编码器接口，若设置为编码器模式则该定时器无法使用其它功能

* 两个输入引脚借用了输入捕获的通道一和通道二

# 二、旋转编码器简介

旋转编码器：用来测量位置、速度或旋转方向的装置，当其旋转轴旋转时，其输出端可以输出与旋转速度和方向对应的方波信号，读取方波信号的频率和相位信息即可得知旋转轴的速度和放下

* 类型：机械触点式/霍尔传感器式/光栅式

![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/zjbmq.png)

原理：首先把A相和B相的所有边沿作为计数器的计数时钟，出现边沿信号时，计数就自增或者自减，至于自增还是自减，计数的方向由另一相的状态来判断，当出现某一个边沿时，我们判断另一相的高低电平，如果对应另一相的状态符合上面的表，则为自增是正转；反之，另一相的状态出现在下面的表里面则为反转，计数自减，这样就可以实现编码器接口的功能了。

![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/bmqjkylt.png)

# 三、编码器接口基本结构

![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/bmqjkjbjg.png)

输入捕获的前两个通道，通过GPIO口接入编码器的A、B相，然后通过滤波器和边沿检测极性选择，产生TI1FP1和TI2FP2，通向编码器接口，编码器接口通过预分频器控制CNT计数器的时钟，同时编码器接口还根据编码器的旋转方向，控制CNT的计数方向，编码器正转时，CNT自增，编码器反转时，CNT自减，对于ARR，一般会设置ARR的最大值为65535，这样利用补码的性质很容易得到负数

对于边沿检测的极性选择，可以实现信号的反转
# 四、编码器工作模式

![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/bmqgzms.png)

正转的状态都向上计数，反转的状态都向下计数

一般使用在TI1和TI2上计数的模式，因为这个模式精度高





