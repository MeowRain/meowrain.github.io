# 一、IC输入捕获
4个输入捕获和输出比较通道，共用4个CCR寄存器，4个通道的引脚也是共用的，因此对于同一个定时器，输入捕获和输出比较只能使用其中一个，不能同时使用

# 二、输入捕获和输出比较的对比

1. 输出比较对应的是输出端口，输入比较对应的是输入端口

2. 输出比较，是根据CNT和CCR的大小关系来执行输出动作；输入捕获，是接收到输入信号，执行CNT锁存到CCR的动作

# 三、输入捕获的作用

1. 可用于测量PWM波形的频率、占空比、脉冲间隔、电平持续时间等参数

2. 可配置为PWMI模式（PWM的输入模式），同时测量频率和占空比

3. 可配合主从触发模式，实现硬件全自动测量


# 四、频率测量的方法

 ![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/plcl.png)

 测频法和测周法都有正负一误差，当计次N比较大时，正负1对N 影响很小

 当待测信号频率小于中届频率时，测周法误差更小，选用测周法更合适。当待测信号频率大于中界频率时，测频法误差更小，选用测频法更合适。

 # 五、主从触发模式

 为了实现计数自动清零的操作，可以使用主从触发模式来进行

 ![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/zccfms.png)

 在触发源选择中，选中TI1FP1从模式执行的操作，就可以选择执行Reset的操作，这样TI1FP1的信号就可以自动触发从模式，从模式自动清零CNT，实现硬件全自动测量

# 六、输入捕获基本结构

![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/SRBHJBJG.png)


先看第一个输入捕获基本结构，这个结构我们只使用了一个通道，所以它目前只能测量频率，在右上角这里是时基单元，我们把时基单元配置好，启动定时器，那这个cnt就会在预分屏之后的这个时钟驱动下不断自增，这个cnt就是我们测周法用来计数计时的东西，经过预分屏之后，这个位置的时钟频率就是驱动cnt的标准频率，fc这里不难看出来，标准频率等于72M/预分频系数，然后下面输入捕获通道一的GPIO口,输入一个这样的方波信号,经过滤波器和边缘检测,选择TI1FP1为上升沿触发,之后输入选择直连的通道,分频器选择不分频,当TI1FP1出现上升沿之后，cnt的当前记录值转运到CCR1里，同时触发源选择选中TI1FP1为触发信号,
从模式选择复位操作,这样TI1FP1的上升沿也会通过上面这一路去触发CNT清零。

CNT计数值就是N的值，然后fc/N就是信号的频率

TI1FP1和TI2FP2只能用通道一和通道二，通道三和通道四没有

 # 七、PWMI基本结构


![](https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/PWMIJBJG.png)

PWMI模式，使用了两个通道同时捕获一个引脚，同时测量周期和占空比

TI1FP1操作同上

TI1FP2配置为下降沿触发，通过交叉通道，去触发通道二的捕获单元 

在上升沿的时候，CCR1=CNT,CNT=0,在下降沿的时候CCR2=CNT，到达下一个上升沿和下降沿同上。此时，CCR2就是高电平期间的计数值，CCR1就是整个周期的计数值，此时CCR2/CCR1就是占空比

